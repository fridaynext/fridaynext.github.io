[{"categories":null,"contents":"From QEMU Quirks to Virtualized Nirvana For years, I\u0026rsquo;ve been a devotee of virtualization, bouncing between bare metal, QEMU, and everything in between. Recent success with Proxmox has truly unlocked a level of performance and convenience I hadn’t thought possible. This post details my journey to building a robust, virtualized environment centered around Proxmox, and the lessons I learned along the way.\nThe QEMU Struggle: A Foundation of Pain My initial foray into GPU passthrough started with QEMU. After months of troubleshooting, compiling kernels from source, and battling secure boot, I achieved near-native benchmarks (and in some benchmarks, I even out-performed bare metal!), but stability proved elusive. The GPU would bind and unbind, but at some point a full system reboot was often required. While I achieved respectable performance, it felt like magic, not a repeatable solution.\nEven though there was plenty of pain, I learned so much about the inner workings of qemu, driver blacklisting, and virtualization in general. Compiling from source became almost a default for me, as I loved being able to configure exactly how programs were compiled, and ensuring I was getting the best performance for my specific hardware.\nProxmox: The Game Changer I knew of Proxmox for a long while before actually implementing it on my own hardware. Once I finally installed it, I saw that it provided a more elegant solution, and the brilliant devs that make Proxmox happen somehow found a way to allow for seamless binding/unbinding of the GPU.\nThat was the part that I got so close to achieving, but never quite got there with qemu. I can now seamlessly switch between a Windows 10 gaming VM and a Debian LLM server, and I have not once run into an issue where I needed to do a full system reboot to regain access to the GPU.\nThe Setup My current Proxmox setup consists of:\nComponent Key Features Host\nDebian 12\nProxmox Virtualization Host i5-12600KIntel IOMMU passthroughSR-IOV2x 16GB DDR5 RAMNvidia 3090FE (Founders Edition)nouveau and nvidia drivers blacklisted on boot, for full VM passthrough capability750W Platinum+ PSU1TB NVMe SSD VM1 (Gaming)\nWindows 10\nHigh-Performance Gaming 12 i5 cores (the P-cores) with host passthrough28GB RAMFull PCIe NVMe SSD controller passthroughFull VFIO Passthrough of 3090FEsmbios settings to avoid issues with anti-cheat kernel implementations VM2 (LLM)\nDebian 12\nLLM Serving \u0026amp; Inference Debian 12 (for best current compatibility with TensorRT builds)12 i5 cores (the P-cores) with host passthrough28GB RAM passed through (w/1GB hugepages)Full VFIO Passthrough of 3090FE28GB RAMdedicated to hosting, serving, and optimizing LLMs. Although, this does not include the Proxmox cluster I\u0026rsquo;ve set up, of which this is only one node. More on that in the future!\nKey Benefits It\u0026rsquo;s all so easy!: The 3090FE seamlessly attaches/detaches between the VMs, enabling both high-performance gaming and efficient LLM inference. Sure, I could compile qemu from source again and try to make this happen, but Proxmox does all that for me! Performance: solid 240 FPS in Rocket League and 45 t/s with Gemma 3B 27B with a 131K context window. Reliability: After years of troubleshooting and compiling qemu from source, this setup is stable. One of my main goals was to not sacrifice anything in the setup of the LLM, so I could get all those benefits that were bragged about in the initial release announcement. I remember reading about \u0026ldquo;largest model to fit in a single consumer GPU!!\u0026rdquo; and \u0026ldquo;enormous 131K context window!\u0026rdquo; - but when I first set it up on ollama, it would crash nearly instantly with a 131K context window.\nI want the full 27B model on my gpu I want the full 131,072 token context window AND I want incredible performance, with GPU vRAM to spare That led to my relentless pursuit of optimized perfection, building llama.cpp from source and reading the man pages (well, the llama-server --help) to ensure I was running with all the optimal settings. This also taught me about all the different architectural aspects of these models, leading me to make more informed decisions about which models I wanted to incorporate into my workflow.\nFuture Plans Explore TensorRT optimization for the LLM VM. Automate the deployment with a more robust configuration management system. Incorporate a custom vector database for enhanced RAG performance. ","date":"November 3, 2025","hero":"/posts/projects/proxmox/hero.jpg","permalink":"https://fridaynext.github.io/posts/projects/proxmox/","summary":"\u003ch2 id=\"from-qemu-quirks-to-virtualized-nirvana\"\u003eFrom QEMU Quirks to Virtualized Nirvana\u003c/h2\u003e\n\u003cp\u003eFor years, I\u0026rsquo;ve been a devotee of virtualization, bouncing between bare metal, QEMU, and everything in between. Recent success with Proxmox has truly unlocked a level of performance and convenience I hadn’t thought possible. This post details my journey to building a robust, virtualized environment centered around Proxmox, and the lessons I learned along the way.\u003c/p\u003e\n\u003ch3 id=\"the-qemu-struggle-a-foundation-of-pain\"\u003eThe QEMU Struggle: A Foundation of Pain\u003c/h3\u003e\n\u003cp\u003eMy initial foray into GPU passthrough started with QEMU. After months of troubleshooting, compiling kernels from source, and battling secure boot, I achieved near-native benchmarks (and in some benchmarks, I even \u003cem\u003eout-performed\u003c/em\u003e bare metal!), but stability proved elusive. The GPU would bind and unbind, but at some point a full system reboot was often required. While I achieved respectable performance, it felt like magic, not a repeatable solution.\u003c/p\u003e","tags":null,"title":"My Proxmox Odyssey"},{"categories":null,"contents":"Go Notes ","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://fridaynext.github.io/notes/go/_index.bn/","summary":"\u003ch1 id=\"go-notes\"\u003eGo Notes\u003c/h1\u003e","tags":null,"title":"Go এর নোট সমূহ"},{"categories":null,"contents":"","date":"January 1, 0001","hero":"/images/default-hero.jpg","permalink":"https://fridaynext.github.io/notes/_index.bn/","summary":"","tags":null,"title":"নোট সমূহ"}]